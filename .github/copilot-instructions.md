<!-- Copied/created by AI: concise, actionable guidance for coding agents -->
# Copilot / AI Agent Instructions for FSearch

Purpose
- Help AI agents become productive quickly with this C/GTK3 project (FSearch).

Big picture (short)
- Project: native C application using GTK3; UI defined with `.ui` files and gresource XML, compiled by Meson.
- Build layout: `src/meson.build` compiles a static `libfsearch` (many `fsearch_*.c` modules) and the `fsearch` executable (`main.c`).

Key files and directories (start here)
- `README.md`: user-facing overview and links to build wiki.
- `meson.build` (root) and `meson_options.txt`: project-wide build settings and `channel` packaging option.
- `src/meson.build`: canonical list of source files (update this list to add new C sources).
- `src/main.c`: program entrypoint; uses `fsearch_application_new()`.
- `src/fsearch_*.c` and `src/fsearch_*.h`: core subsystems (index, database, query lexer/parser, UI, tasks, thread pool).
- `src/*.ui` and `src/gresource.xml`: GTK UI and resources; changes require regenerating compiled resources via Meson build.
- `po/`: gettext translations (GETTEXT_PACKAGE configured in `meson.build`).
- `data/`, `debian/`, `copr/`, `snap/`: packaging metadata — useful for packaging and channel-specific behavior.

Project conventions and patterns (concrete)
- C standard: gnu11 (see `meson.build`). Use the `fsearch_` prefix for public/internal symbols and filenames.
- Modularization: heavy separation between UI (`fsearch_window.c`, `*.ui`), indexing (`fsearch_index.c`, `fsearch_database_*.c`) and query parsing (`fsearch_query_*.c`). When adding features, find the closest `fsearch_*.c` module.
- Build artifacts: Meson generates `config.h`; features/defines are controlled via `meson_options.txt` and `meson` args (e.g., `-Dchannel=`).

Build / run / test (copy-paste)
```bash
meson setup build --reconfigure  # first-time: meson setup build
meson compile -C build          # build (or: ninja -C build)
./build/fsearch                 # run the built executable
meson test -C build             # run tests (if configured in src/tests)
```
- To change packaging channel (affects `config.h`): `meson setup build -Dchannel=copr-nightly` then build.

Editing UI / resources
- Edit `src/*.ui` or `data/gresource.xml`, then rebuild. The resource C sources are generated by `gnome.compile_resources` in `src/meson.build`.

Adding source files
- Add new `*.c` to the `libfsearch_sources` array in `src/meson.build`. Keep naming consistent with `fsearch_` prefix.

Dependencies & environment
- Key native deps: GTK 3.18+, GLib 2.50+, PCRE2, ICU. Meson will fail fast if these aren't present.
- Localization: gettext is used. `bindtextdomain(GETTEXT_PACKAGE, LOCALEDIR)` is set in `src/main.c`.

Debugging tips (practical)
- Run under gdb from the repo root: `gdb --args ./build/fsearch` then `run`.
- Use `meson compile -C build` while iterating; Meson preserves generated resource sources.

What to watch for in diffs
- `src/meson.build` or `meson_options.txt` changes often accompany new source files or packaging/channel changes.
- Changes to `src/gresource.xml`, `data/gresource.xml` or `.ui` should be tested visually — they affect startup and menus.

When to ask a human
- Ambiguous behavior in the query engine, architectural changes that affect indexing/database formats, or packaging/channel policy.

References (examples in repo)
- `src/main.c`, `src/meson.build`, `src/fsearch_index.c`, `src/fsearch_query_parser.c`, `src/gresource.xml`

If anything here is unclear or you want this tuned (more build examples, test commands, or contributor workflow), please ask.
